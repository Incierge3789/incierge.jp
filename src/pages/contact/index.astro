---
// src/pages/contact/index.astro
import Base from "../../layouts/Base.astro";
const title = "Contact｜INCIERGE";
const desc =
  "ご相談フォーム。GPTでの事前相談メモがあれば自動入力されます。?prefill= もしくは ?gpts= で取り込み。";
---
<Base title={title} description={desc}>
  <h1>Contact</h1>
  <p>以下のフォームにご記入ください。<br/>GPTの事前相談メモは <code>?prefill=</code> または <code>?gpts=</code> で自動入力されます。</p>

  <form method="POST" action="/api/contact" class="mt-6 space-y-4">
    <label class="block">
      <span>お名前（必須）</span>
      <input name="name" required class="w-full border rounded px-3 py-2" />
    </label>

    <label class="block">
      <span>メール（必須）</span>
      <input type="email" name="email" required class="w-full border rounded px-3 py-2" />
    </label>

    <label class="block">
      <span>会社名（任意）</span>
      <input name="company" class="w-full border rounded px-3 py-2" />
    </label>

    <label class="block">
      <span>HP（任意）</span>
      <input name="website" class="w-full border rounded px-3 py-2" />
    </label>

    <label class="block">
      <span>ご相談内容（必須）</span>
      <textarea id="message" name="message" rows="10" required class="w-full border rounded px-3 py-2"></textarea>
    </label>

    <button type="submit" class="btn-primary">送信</button>
  </form>

  <script>
    (function () {
      var el = document.getElementById("message");
      if (!el) return;
      var p = new URLSearchParams(location.search);
      var raw = p.get("gpts") || p.get("prefill");
      if (raw) {
        try {
          var text = p.get("gpts") ? atob(decodeURIComponent(raw)) : decodeURIComponent(raw);
          el.value = text;
          var n = document.createElement("div");
          n.textContent = "AI相談メモを読み込みました。必要に応じて追記・修正してください。";
          n.className = "mt-4 text-sm opacity-80";
          el.parentElement.insertBefore(n, el);
        } catch (e) {}
      } else {
        var memo = localStorage.getItem("incierge:gpts:intake");
        if (memo) el.value = memo;
      }
    })();
  </script>
</Base>
